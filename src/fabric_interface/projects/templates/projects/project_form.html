{% extends "fabric_interface/layouts/sidebar_double.html" %}

{% load i18n guardian_tags bootstrap3 %}

{% block title %}{{ title }}{% endblock %}

{% block sidebar_left %}
    <!-- panel/projects -->
    <div class="well well-sm">
        <ul class="nav nav-list">
            <li class="nav-header">{% trans "All projects" %}</li>
            {% for project in project_list %}
                {% get_obj_perms request.user for project as "project_perms" %}
                {% if "view_project" in project_perms or perms.projects.view_project %}
                    <li class="{% if project.slug == object.slug %}active{% endif %}">
                        <a href="{% url 'project_detail' slug=project.slug %}">{{ project }}</a>
                    </li>
                {% endif %}
            {% endfor %}
            {% if perms.projects.add_project %}
                <li class="action">
                    <a href="{% url 'project_create' %}">
                        <i class="glyphicon glyphicon-plus"></i> {% trans "Add project" %}
                    </a>
                </li>
            {% endif %}
        </ul>
    </div>
    <!-- panel/hosts -->
    <div class="well well-sm">
        <ul class="nav nav-list">
            <li class="nav-header">{% trans "Available hosts" %}</li>
            {% for host in host_list %}
                <li><a href="{% url 'host_detail' slug=host.slug %}">{{ host }}</a></li>
            {% empty %}
                <li>{% trans "No hosts available." %}</li>
            {% endfor %}
            <li class="action"><a href="{% url 'host_create' %}"><i class="glyphicon glyphicon-plus"></i> {% trans "Add host" %}</a></li>
        </ul>
    </div>
    {% if request.user.is_superuser %}
        <!-- panel/users -->
        <div class="well well-sm">
            <ul class="nav nav-list">
                <li class="nav-header">{% trans "Users" %}</li>
                {% for user in user_list %}
                    <li><a href="{% url 'user_detail' pk=user.pk %}">{{ user }}</a></li>
                {% endfor %}
                <li class="action"><a href="{% url 'user_create' %}"><i class="glyphicon glyphicon-plus"></i> {% trans "Add user" %}</a></li>
            </ul>
        </div>
    {% endif %}
{% endblock %}

{% block content %}
    <h4>{% if object %}{% trans "Edit project" %}{% else %}{% trans "Add project" %}{% endif %}</h4>
    <hr />
    <form method="post" role="form">
        {% csrf_token %}
        {% for field in form %}
            <div class="form-group">
                {% bootstrap_field field %}
            </div>
        {% endfor %}
        {% buttons %}
            <button type="submit" class="btn btn-default">
                {% if action == 'create' %}
                    {% bootstrap_icon "plus" %} {{ title }}
                {% else %}
                    {% bootstrap_icon "pencil" %} {{ title }}
                {% endif %}
            </button>
            {% if action != 'create' %}
                <a href="{% url 'project_delete' slug=object.slug %}" class="btn btn-danger pull-right">
                    {% bootstrap_icon "remove" %} {% trans "Delete" %}
                </a>
            {% endif %}
        {% endbuttons %}
    </form>
{% endblock %}